{% extends "web/base.html" %}

{% block title %}Insumos{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Insumos</h1>
    <a href="{% url 'web:insumos_create' %}" class="btn btn-primary">
        + Nuevo insumo
    </a>
</div>

<form method="get" class="row mb-3">
    <div class="col-sm-4">
        <input
          type="text"
          name="q"
          value="{{ request.GET.q }}"
          placeholder="Buscar por nombre, categoría o proveedor..."
          class="form-control"
        >
    </div>
    <div class="col-sm-2">
        <button class="btn btn-outline-secondary" type="submit">Buscar</button>
    </div>
</form>

<table class="table table-striped table-sm">
<thead>
    <tr>
        <th>Nombre</th>
        <th>Unidad consumo</th>
        <th>Categoría</th>
        <th>Proveedor principal</th>
        <th>Stock actual</th>  
        <th>Stock mín.</th>
        <th>Stock máx.</th>
        <th>Activo</th>
        <th></th>
    </tr>
</thead>
    <tbody>
{% for insumo in insumos %}
    <tr>
        <td>{{ insumo.nombre }}</td>
        <td>{{ insumo.unidad }}</td>
        <td>{{ insumo.categoria }}</td>
        <td>{{ insumo.proveedor_principal }}</td>
        <td>
        {% with nivel=insumo.nivel_alerta_global|default:"verde" %}
            {% if nivel == 'rojo' %}
                <i class="bi bi-exclamation-octagon-fill text-danger fs-4"></i>
            {% elif nivel == 'amarillo' %}
                <i class="bi bi-exclamation-triangle-fill text-warning fs-4"></i>
            {% else %}
                <i class="bi bi-check-circle-fill text-success fs-4"></i>
            {% endif %}
            <span class="ms-2">{{ insumo.total_stock|default:"0" }}</span>
        {% endwith %}
        </td>
        <td>{{ insumo.stock_minimo }}</td>
        <td>{{ insumo.stock_maximo }}</td>
        <td>
            {% if insumo.activo %}
                <span class="badge bg-success">Sí</span>
            {% else %}
                <span class="badge bg-secondary">No</span>
            {% endif %}
        </td>
        <td class="text-end">
            <a href="{% url 'web:insumos_update' insumo.pk %}" class="btn btn-sm btn-outline-primary">
                Editar
            </a>
            <form action="{% url 'web:insumos_delete' insumo.pk %}" method="post" style="display:inline">
                {% csrf_token %}
                <button type="submit"
                        class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('¿Seguro que quieres eliminar este insumo?')">
                    Eliminar
                </button>
            </form>
        </td>
    </tr>
{% empty %}
    <tr>
        <td colspan="9" class="text-center">No hay insumos registrados.</td>
    </tr>
{% endfor %}
</tbody>
</table>

{% endblock %}